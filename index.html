<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Kanhiya's Advanced Task Manager</title>
  <style>
    :root {
      --bg-light: #ffffff; --text-light: #333333;
      --bg-dark: #1e1e1e;   --text-dark: #f0f0f0;
      --highlight: #fff4c1; --accent: #007bff;
      --sep: #e0e0e0;       --light-grey: #f2f2f2;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family:'SF Pro',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;
      background:var(--bg-light); color:var(--text-light);
      padding:20px; transition:background .3s,color .3s;
    }
    body.dark { background:var(--bg-dark); color:var(--text-dark); }
    .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
    .switch { position:relative; display:inline-block; width:40px; height:20px; }
    .switch input { opacity:0; width:0; height:0; }
    .slider { position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0;
      background:#ccc; transition:.4s; border-radius:20px;}
    .slider:before { position:absolute; content:""; height:16px; width:16px;
      left:2px; bottom:2px; background:#fff; transition:.4s; border-radius:50%;}
    input:checked + .slider { background:var(--accent); }
    input:checked + .slider:before { transform:translateX(20px); }
    .filters button { background:none; border:none; margin:0 5px; padding:5px 10px;
      cursor:pointer; font-weight:600; }
    .filters button.active { color:var(--accent); }
    .progress { font-size:14px; }
    .header h1 { font-size:32px; margin-bottom:5px; }
    .current-time { font-size:16px; color:#777; margin-bottom:20px; }
    .actions { display:flex; gap:10px; margin-bottom:20px; }
    .actions button { font-size:16px; border:none; background:none; cursor:pointer; }
    .add-task { color:var(--accent); }
    .clear-btn { color:red; }
    .task-list { display:flex; flex-direction:column; }
    .task-item { display:flex; align-items:center; padding:15px 0;
      border-top:1px solid var(--sep); transition:background-color .3s,opacity .3s; }
    .task-item:first-child { border-top:none; }
    .task-item.completed { opacity:.6; }
    .task-item.completed label { text-decoration:line-through; }
    .task-item input[type="checkbox"] { margin-right:10px; width:20px; height:20px; cursor:pointer; }
    .task-item label { flex:1; font-size:18px; cursor:pointer; }
    .task-time { display:flex; gap:8px; margin-right:10px; }
    .task-time span { background:var(--light-grey); border-radius:8px;
      padding:6px 10px; font-weight:600; cursor:pointer; }
    .delete-btn { background:none; border:none; color:red; cursor:pointer;
      font-size:14px; opacity:.7; transition:opacity .2s; }
    .delete-btn:hover { opacity:1; }
    .popup { display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
    .popup-content { background:var(--bg-light); color:var(--text-light);
      padding:30px; border-radius:12px; width:320px; display:flex;
      flex-direction:column; gap:10px; }
    body.dark .popup-content { background:var(--bg-dark); color:var(--text-dark); }
    .popup-content input { padding:10px; border:1px solid #ccc; border-radius:6px;
      font-size:16px; }
    .popup-content .done-btn { padding:10px; background:var(--accent); color:#fff;
      border:none; border-radius:6px; cursor:pointer; font-size:16px; }
    .popup-content .close-btn { padding:10px; background:#ccc; color:#333;
      border:none; border-radius:6px; cursor:pointer; font-size:16px; }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="switch">
      <input type="checkbox" id="toggleTheme"><span class="slider"></span>
    </div>
    <div class="filters">
      <button data-filter="all" class="active">All</button>
      <button data-filter="pending">Pending</button>
      <button data-filter="completed">Completed</button>
    </div>
    <div class="progress" id="progress">0 of 0 completed</div>
  </div>

  <div class="header">
    <h1>hi, kanhiya! üëãüèª</h1>
    <p class="current-time" id="currentTime"></p>
    <div class="actions">
      <button id="openPopupBtn" class="add-task">+ add new task</button>
      <button id="clearAllBtn" class="clear-btn">clear all tasks</button>
    </div>
  </div>

  <div id="tasks" class="task-list"></div>

  <div class="popup" id="popup">
    <div class="popup-content">
      <h2>Add New Task</h2>
      <input type="text" id="taskName" placeholder="Task Name"/>
      <input type="date" id="taskDate"/>
      <input type="time" id="taskTime"/>
      <button id="doneBtn" class="done-btn">Done</button>
      <button id="cancelBtn" class="close-btn">Cancel</button>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // Elements
    const openPopupBtn = document.getElementById('openPopupBtn');
    const cancelBtn    = document.getElementById('cancelBtn');
    const doneBtn      = document.getElementById('doneBtn');
    const clearAllBtn  = document.getElementById('clearAllBtn');
    const popup        = document.getElementById('popup');
    const taskNameEl   = document.getElementById('taskName');
    const taskDateEl   = document.getElementById('taskDate');
    const taskTimeEl   = document.getElementById('taskTime');
    const tasksContainer = document.getElementById('tasks');
    const filterBtns   = Array.from(document.querySelectorAll('.filters button'));
    const progressEl   = document.getElementById('progress');
    const currentTimeEl = document.getElementById('currentTime');
    const themeToggle  = document.getElementById('toggleTheme');

    // State
    let tasks = JSON.parse(localStorage.getItem('tasks')||'[]');
    let currentFilter = 'all';

    // Save helper
    function save() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
    }

    // Theme toggle
    if (themeToggle) {
      const saved = localStorage.getItem('theme')||'light';
      document.body.classList.toggle('dark', saved==='dark');
      themeToggle.checked = saved==='dark';
      themeToggle.addEventListener('change', function() {
        document.body.classList.toggle('dark', this.checked);
        localStorage.setItem('theme', this.checked?'dark':'light');
      });
    }

    // Filters
    filterBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        filterBtns.forEach(b=>b.classList.remove('active'));
        this.classList.add('active');
        currentFilter = this.dataset.filter;
        render();
      });
    });

    // Live clock
    function tick() {
      const now = new Date();
      currentTimeEl.innerText = 
        `it‚Äôs ${now.toLocaleString('en-GB',{day:'numeric',month:'long',year:'numeric',hour:'2-digit',minute:'2-digit'})} right now.`;
    }
    setInterval(tick, 1000);
    tick();

    // Popup open/close
    openPopupBtn.addEventListener('click', () => popup.style.display='flex');
    cancelBtn   .addEventListener('click', () => popup.style.display='none');

    // Add task
    doneBtn.addEventListener('click', function() {
      const name = taskNameEl.value.trim(),
            date = taskDateEl.value,
            time = taskTimeEl.value;
      if (!name || !date || !time) {
        alert('Please fill all fields!');
        return;
      }
      tasks.push({ id:Date.now(), name, date, time, completed:false });
      save();
      popup.style.display='none';
      taskNameEl.value=taskDateEl.value=taskTimeEl.value='';
      render();
    });

    // Clear all
    clearAllBtn.addEventListener('click', function() {
      if (confirm('Clear all tasks?')) {
        tasks = [];
        save();
        render();
      }
    });

    // Format helpers
    function formatTime(t) {
      let [h,m] = t.split(':').map(Number),
          ap = h>=12?'PM':'AM';
      if (h>12) h-=12;
      if (h===0) h=12;
      return `${h}:${String(m).padStart(2,'0')} ${ap}`;
    }
    function formatDate(d) {
      const todayStr = new Date().toDateString(),
            selStr   = new Date(d).toDateString();
      return todayStr===selStr
        ? 'Today'
        : new Date(d).toLocaleDateString('en-GB',{day:'numeric',month:'short'});
    }

    // Render function
    function render() {
      tasksContainer.innerHTML = '';
      tasks
        .filter(t => (currentFilter==='all') ||
                     (currentFilter==='completed' && t.completed) ||
                     (currentFilter==='pending' && !t.completed))
        .forEach(task => {
          const div = document.createElement('div');
          div.className = 'task-item' + (task.completed?' completed':'');
          if (new Date(task.date).toDateString()===new Date().toDateString()) {
            div.style.backgroundColor='var(--highlight)';
          }
          div.innerHTML = `
            <input type="checkbox"${task.completed?' checked':''}/>
            <label>${task.name}</label>
            <div class="task-time"><span>${formatTime(task.time)}</span><span>${formatDate(task.date)}</span></div>
            <button class="delete-btn">delete</button>
          `;
          // Bind events
          const cb  = div.querySelector('input'),
                lbl = div.querySelector('label'),
                tt  = div.querySelector('.task-time'),
                db  = div.querySelector('.delete-btn');

          cb.addEventListener('change', () => {
            task.completed = cb.checked;
            save(); render();
          });
          lbl.addEventListener('dblclick', () => {
            const nn = prompt('Edit task name', task.name);
            if (nn) { task.name=nn; save(); render(); }
          });
          tt.addEventListener('click', () => {
            const nt = prompt('New time (HH:MM)', task.time),
                  nd = prompt('New date (YYYY-MM-DD)', task.date);
            if (nt && nd) { task.time=nt; task.date=nd; save(); render(); }
          });
          db.addEventListener('click', () => {
            tasks = tasks.filter(x=>x.id!==task.id);
            save(); render();
          });
          tasksContainer.appendChild(div);
        });
      progressEl.innerText = 
        `${tasks.filter(x=>x.completed).length} of ${tasks.length} completed`;
    }

    // Initial render
    render();

  });
  </script>
</body>
</html>
